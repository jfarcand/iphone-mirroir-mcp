#!/usr/bin/env node
// ABOUTME: Thin wrapper that launches the native MCP server binary.
// ABOUTME: Routes "install" subcommand to the interactive MCP client configuration script.

const { execFileSync } = require("child_process");
const fs = require("fs");
const path = require("path");

const binDir = __dirname;
const pkgDir = path.dirname(binDir);
const binary = path.join(binDir, "mirroir-mcp-native");
const installScript = path.join(pkgDir, "install-cmd.js");

// Handle "install" subcommand â€” interactive MCP client configuration
if (process.argv[2] === "install") {
  if (!fs.existsSync(installScript)) {
    console.error("Install script not found. Run: npm rebuild mirroir-mcp");
    process.exit(1);
  }
  try {
    execFileSync("node", [installScript], { stdio: "inherit" });
  } catch (e) {
    console.error("Install failed. See https://github.com/jfarcand/mirroir-mcp for manual install.");
    process.exit(1);
  }
  process.exit(0);
}

// Run the MCP server
try {
  execFileSync(binary, process.argv.slice(2), { stdio: "inherit" });
} catch (e) {
  if (e.status != null) process.exit(e.status);
  console.error("mirroir-mcp binary not found. Run: npm rebuild mirroir-mcp");
  process.exit(1);
}
